---
id: metrics-for-fleet-reliability
title: Measuring Fleet Reliability With Crash-Free Hours
sidebar_label: Measuring Fleet Reliability
---

Once devices leave the factory and are live in the field, visibility into their
operation drastically decreases. Changes to the fleet like deploying a new
update, releasing new hardware revisions, introducing new features all bring
elements of uncertainty. Without measuring device behavior, fleet operators
cannot begin to understand fleet reliability.

In this guide, we will discuss how to measure device reliability using
crash-free hours and Memfault.

## Reliability Engineering Background Material

Before we get to using Memfault to measure fleet reliability, we will discuss
two points of inspiration for this metric.

### Mean Time Between Failures

We begin by taking some inspiration from reliability engineering. When producing
a component, a common reliability metric used is Mean Time Between Failures
(MTBF). A simple but imprecise definition of MTBF is the following[^1]:

$$
\textit{MTBF} = \frac{\textit{Total Operating Hours}}{\textit{Number of Failures}}
$$

A more precise version of MTBF can be derived by modeling component failures as
random variables with an exponential distribution. There are many resources that
go into detail on how MTBF and the exponential distribution relate to one
another, you can find resources on this in the footnotes below. The main
takeaway is that MTBF is a parameter of the _population_ being measured. It
should not be utilized as a probability of an individual unit. With a parameter
similar to MTBF we could measure reliability of a device fleet.

### The Bathtub Curve

The bathtub curve[^2] is another concept we can use from reliability engineering
to think about how to measure failures across a fleet. This curve illustrates
device reliability over time. Early on, failures are high but decreasing as time
goes on due to production fixes and improvements. As the early failures are
fixed random and unsolved failures become the dominant mode. Finally as the
device reaches the end of the expected lifetime, wear failures take over as the
primary cause. The combination the three components yields a curve that
resembles a bathtub, hence the name. This curve provides a good mental model for
thinking about device reliability. Initially a high failure rate decreases as
device stability increases over time. This reaches a plateau due to randomness
and unsolved failures. The final stage we see failure rate increases as the
device reaches end of life.

<p align="center">
  <img
    width="800"
    src="/img/docs/best-practices/crash-free-hours-bathtub-curve.png"
    alt="Diagram showing the three components that compose the bathtub curve found in reliability engineering."
  />
</p>

The middle section of the bathtub curve is important to measuring MTBF. This
middle section of the curve is where random errors dominate the failure rate,
leading to the most accurate measure of MTBF.

<!-- prettier-ignore-start -->
:::info

The bathtub curve is somewhat contested in the field as being too simplistic.
There is an interesting debate on how to utilize the empirical findings that
yield curves like these.
For more information, see these references.[^3]<sup>, </sup>[^4]

:::
<!-- prettier-ignore-end -->

## Crash-Free Hours and Memfault

With the ideas of MTBF and the bathtub curve from reliability engineering, we
can use Memfault to create a suitable fleet metric to measure device
reliability. In the case of IoT device firmware, MTBF's definition does not
align quite right. Failures caused by device firmware are not represented well
by random events. IoT device updates require a way to measure reliability across
updates, which are more represented in the early portion of the curve.

Instead of attempting to measure the random error rate via MTBF, we can shift
our focus to the early portion of the bathtub curve and focus on measuring the
fixable failures. The metric Memfault uses for this task is Crash-Free Hours.
Crash-Free Hours provide insight into device reliability across updates and
measure the early phase failures, not random failures that cannot be attributed
to device firmware. Before moving on to define Crash-Free Hours, we need to
define what marks an hour as crash-free.

### Defining Unexpected Reboots

To determine when a crash-free hour occurs, we use the presence of an unexpected
reboot within that time frame. Reboots can occur under several scenarios during
a device's operation:

- Device updates
- User initiated reboots
- Fault handling
- Watchdog resets

The last two instances are what should be classified as unexpected reboots as a
device should not encounter these during normal operation. The
[reboot reason tracking subsystem](/docs/mcu/reboot-reason-tracking) can be used
exactly for this purpose. When tracking Crash-Free Hours, it is very important
to classify reboot reasons as accurate and precisely as possible.

### Defining Crash Free Hours

Now that we have the foundation set, we can define Crash-Free Hours. The first
step is to define a length of time we'd like to measure Crash-Free Hours over.
The next step is to collect the total operating hours of all devices in the
fleet. Next we count the number of hours an unexpected reboot occurred. With
these two parts we can calculate the percentage of hours in which _no_ crashes
occurred or % of Crash-Free Hours. Here is the formula:

$$
\textit{\% Crash-Free Hours} = 100 * (1 - \frac{\textit{Total Hours With A Crash}}{\textit{Total Device Hours}})
$$

We use a percentage to normalize this metric which provides an easier way to
compare across time periods and versions.

## Enable Crash-Free Hours on Your Devices

:::info

At this time, only MCU devices are supported. Android and Linux support will be
added to future SDK releases.

:::

### MCU Devices

Due to changes in the reboot reason tracking subsystem, the MCU SDK requires
version 0.37.0 or higher to collect data for tracking Crash-Free Hours. Once a
device is running at least version 0.37.0, the SDK will automatically collect
the required data in a metric called
`MemfaultSdkMetric_UnexpectedRebootDidOccur`.

## Viewing Crash-Free Hours on Memfault

Crash-Free Hours is not available to be viewed directly on Memfault. However you
can create a few charts in the Metrics section to display Total Operational
Hours and Total Hours With Crashes. With these two charts, Crash-Free Hours can
be calculated.

1. Create a chart to track Total Operational Hours:

<p align="center">
  <img
    width="400"
    src="/img/docs/best-practices/crash-free-hours-total-operational.png"
    alt="Total operational hours metric chart"
  />
</p>

2. Create a chart to track Total Hours With Crashes:

<p align="center">
  <img
    width="400"
    src="/img/docs/best-practices/crash-free-hours-total-w-crash.png"
    alt="Total hours with a crash metric chart"
  />
</p>

Now that we have our charts, we can calculate % of Crash-Free Hours using our
forumla.

## References and Further Reading

[^1]: [Applied Statistics: MTBF](http://www.applied-statistics.org/mtbf.html#3)
[^2]:
    [Applied Statistics: Bathtub Curve](http://www.applied-statistics.org/Glossary/BathTubCurve.html])

[^3]:
    [A critical look at the bathtub curve](https://www.researchgate.net/profile/Georgia-Ann-Klutke/publication/3152592_A_critical_look_at_the_bathtub_curve/links/00b7d52385fd48960e000000/A-critical-look-at-the-bathtub-curve.pdf)

[^4]:
    [Comment: "Burn-In" Makes Us Feel Good](https://www.jstor.org/stable/2246263)
    (_Requires JSTOR account to access_)
