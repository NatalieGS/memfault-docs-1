---
id: reference-memfaultd-cli
title: "Reference: memfaultd CLI"
sidebar_label: "memfaultd CLI"
---

Useful links:

- [Reference: `memfaultd` Configuration][docs-configuration].
- [Source for `memfaultd`][source-memfaultd].

## Basic Usage

Running `memfaultd --help` prints the following:

```
Usage: memfaultd [OPTION]...

      --config-file <file>       : Configuration file
      --daemonize                : Daemonize process
      --enable-data-collection   : Enable data collection, will restart the main memfaultd service
      --disable-data-collection  : Disable data collection, will restart the main memfaultd service
  -h, --help                     : Display this help and exit
  -s, --show-settings            : Show settings
  -v, --version                  : Show version information
```

The `--config-file` path defaults to `/etc/memfaultd.conf`. The settings you add
in `/etc/memfaultd.conf` extend the built-in configuration file.

[source-builtin-conf]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault/recipes-memfault/memfaultd/files/memfaultd/builtin.conf

#### Sample output from `memfaultd --show-settings`

```
Base configuration (/etc/memfaultd.conf):
  { "queue_size_kib": 1024, "data_dir": "\/media\/memfaultd", "refresh_interval_seconds": 3600, "enable_data_collection": false, "swupdate_plugin": { "input_file": "\/etc\/swupdate.cfg", "output_file": "\/tmp\/swupdate.cfg" }, "reboot_plugin": { "uboot_fw_env_file": "\/etc\/fw_env.config" }, "collectd_plugin": { "output_file": "\/tmp\/collectd.conf" } }

Runtime configuration:
  { "enable_data_collection": true }

Device configuration from memfault-device-info:
  MEMFAULT_DEVICE_ID=some-device-a466-4ad8-8eeb-6234ad623449
  MEMFAULT_SOFTWARE_VERSION=1.0.0
  MEMFAULT_SOFTWARE_TYPE=main
  MEMFAULT_HARDWARE_VERSION=prod
  MEMFAULT_BASE_URL=https://device.memfault.com
  MEMFAULT_PROJECT_KEY=<YOUR_PROJECT_KEY>

Plugin enabled:
  reboot
  swupdate
  collectd
```

Note that plugins can be [opted out of][docs-control-memfaultd-plugins] at build
time.

## Usage in a `systemd` service

:::tip

The [`meta-memfault` Yocto layer][source-meta-memfault] already includes a
service file, so you don't need to add one if you're using `meta-memfault`.

:::

You can use the `--daemonize` flag for this. See this example, taken from the
[`meta-memfault` layer][source-memfaultd-service]:

```systemd
[Unit]
Description=memfaultd daemon
After=local-fs.target network.target
Before=swupdate.service collectd.service

[Service]
Type=forking
PIDFile=/run/memfaultd.pid
ExecStart=/usr/bin/memfaultd --daemonize
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

The `Before=` parameter is necessary if you're [using OTA][docs-ota] because the
configuration file used by `swupdate.service` is generated by the `memfaultd`
daemon, so `memfaultd` needs to start before it. If you're not using OTA, you
may want to [opt out of the `swupdate` plugin][docs-control-memfaultd-plugins].

[docs-configuration]: /docs/linux/reference-memfaultd-configuration
[docs-ota]: /docs/linux/linux-releases-integration-guide
[docs-control-memfaultd-plugins]:
  /docs/linux/linux-getting-started-guide#optional-opt-out-of-memfaultd-built-in-plugins
[source-meta-memfault]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault
[source-memfaultd]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault/recipes-memfault/memfaultd/files/memfaultd
[source-memfaultd-service]:
  https://github.com/memfault/memfault-linux-sdk/blob/main/meta-memfault/recipes-memfault/memfaultd/files/memfaultd.service
[systemd-pstore]:
  https://www.freedesktop.org/software/systemd/man/systemd-pstore.service.html
