---
id: linux-custom-metrics
title: Linux Custom Metrics
sidebar_label: Custom Metrics
---

## Introduction

The `collectd` plugin (see [the source code][source-memfaultd-collectd-plugin])
configures CollectD to regularly upload collected metrics to Memfault. These
metrics:

- Are shown on the [device timeline][docs-timeline].
- Are available for use as [Timeseries][docs-timeseries] or
  [Attributes][docs-attributes] metrics, aggregated across the entire fleet.
- Can be used to create [Metric Charts][docs-metric-charts] and
  [Alerts][docs-alerts].

See [Metrics](/docs/platform/metrics) for more details on how metrics can be
configured and used in the Memfault dashboard.

## Prerequisites

### The `memfaultd` daemon

Follow the [getting-started guide][docs-linux-getting-started] to learn how to
set this up for your device. A key function of `memfaultd` is to correctly
configure and control CollectD to talk to Memfault.

:::tip

Keep [`meta-memfault-example`][source-yocto-example] open as a reference
implementation. Your integration should look similar to it once you're done
following the steps in this tutorial.

:::

## Configuring CollectD

We strongly recommend familiarizing yourself with [CollectD][collectd-homepage]
and how it's configured in order to make the best use of the Memfault platform.

The `memfaultd` daemon generates a configuration file, by default in
`/tmp/collectd.conf`, with information about the device provided by
[`memfault-device-info`][docs-memfault-device-info] (see the [getting-started
guide][docs-linux-getting-started] for more information). Note that the path
where this configuration file is generated [can be configured in
`/etc/memfaultd.conf`][docs-configuration] using the
`plugin_collectd.output_file` configuration key.

A minimal configuration file to configure CollectD to post to Memfault looks
like this:

```conf
Interval 3600

# Your configuration here.

Include "/tmp/collectd.conf" # Or the value of your plugin_collectd.output_file
```

If you inspect the generated `/tmp/collectd.conf` file, you'll find that it
simply configures the `write_http` plugin to talk to Memfault.

### Recommended configuration

See [our recommended CollectD configuration in
`meta-memfault-example`][source-recommended-collectd-conf].

This configuration makes use of standard plugins that enjoy special support on
the Memfault platform...

TODO: specify plugins

### Extending the configuration

TODO:

- Metrics filtered out from the Memfault write target
- Adding your own write targets before they're filtered out

#### Example: custom write targets, plus Memfault

## Application metrics

### Using C

### Using Python

[collectd-homepage]: https://collectd.org/
[collectd-write-http]: https://collectd.org/wiki/index.php/Plugin:Write_HTTP
[collectd-chains]: https://collectd.org/wiki/index.php/Chains
[source-yocto-example]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault-example
[source-meta-memfault]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault
[source-memfaultd]:
  https://github.com/memfault/memfault-linux-sdk/tree/main/meta-memfault/recipes-memfault/memfaultd/files/memfaultd
[source-recommended-collectd-conf]:
  https://github.com/memfault/memfault-linux-sdk/tree/master/meta-memfault-example/recipes-extended/collectd/files/collectd.conf
[source-memfaultd-collectd-plugin]:
  https://github.com/memfault/memfault-linux-sdk/blob/main/meta-memfault/recipes-memfault/memfaultd/files/memfaultd/plugins/collectd.c
[docs-linux-getting-started]: /docs/linux/linux-getting-started-guide
[docs-linux-control-plugins]:
  /docs/linux/linux-getting-started-guide#optional-opt-out-of-memfaultd-built-in-plugins
[docs-memfault-device-info]:
  /docs/linux/linux-getting-started-guide#add-a-memfault-device-info-executable-to-your-build
[docs-configuration]: /docs/linux/reference-memfaultd-configuration
[docs-metrics]: /docs/platform/metrics
[docs-timeseries]: /docs/platform/metrics#timeseries
[docs-attributes]: /docs/platform/metrics#attributes
[docs-timeline]: /docs/platform/introduction/#metrics
[docs-metric-charts]: /docs/platform/charts#metric-charts
[docs-alerts]: /docs/platform/alerts
